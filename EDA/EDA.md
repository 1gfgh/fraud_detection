# Exploratory Data Analysis и baseline-моделирование  

---

## 1. Описание данных

В работе использован синтетический датасет PaySim, моделирующий банковские транзакции с бинарной разметкой мошенничества (`isFraud`).

После предварительной очистки и отбора признаков итоговый датасет имеет следующий вид:

- **Размер датасета:** 6 362 620 строк × 6 столбцов
- **Используемые признаки:**
  - `step` — временной шаг (1 шаг = 1 час)
  - `type` — тип транзакции
  - `amount` — сумма транзакции
  - `nameOrig` — идентификатор отправителя
  - `nameDest` — идентификатор получателя
  - `isFraud` — целевая переменная (0 — обычная, 1 — мошенническая)

Пропуски в данных **отсутствуют**: доля пропущенных значений по всем колонкам равна 0%.

---

## 2. Общий анализ и дисбаланс классов

Распределение целевой переменной:

- **Обычные транзакции:** 6 354 407 (99.8709%)
- **Мошеннические транзакции:** 8 213 (0.1291%)

Таким образом, в данных наблюдается **сильный дисбаланс классов**, что делает задачу особенно чувствительной к выбору метрик качества и стратегии обучения моделей.

---

## 3. Анализ типов транзакций

В датасете присутствует 5 типов транзакций:

| Тип транзакции | Количество | Доля |
|---------------|-----------:|------:|
| CASH_OUT | ≈2 237 500 | 35.2% |
| PAYMENT | ≈2 151 495 | 33.8% |
| CASH_IN | ≈1 399 284 | 22.0% |
| TRANSFER | ≈532 909 | 8.4% |
| DEBIT | ≈41 432 | 0.7% |

### Связь типов транзакций с мошенничеством

Мошеннические операции наблюдаются **только в двух типах транзакций**:

- **TRANSFER** — 0.7688% мошеннических транзакций  
- **CASH_OUT** — 0.1840% мошеннических транзакций  

Абсолютное количество мошеннических транзакций:
- CASH_OUT — 4 116
- TRANSFER — 4 097
- CASH_IN / PAYMENT / DEBIT — 0

Это означает, что тип операции является одним из ключевых сигналов мошенничества в данных.

---

## 4. Анализ суммы транзакций (`amount`)

Распределение сумм транзакций обладает сильной правосторонней асимметрией: основная масса операций имеет небольшую сумму, при этом присутствуют редкие транзакции величиной до ≈ 90 млн.

Сравнение обычных и мошеннических транзакций показывает:

- мошеннические операции имеют **существенно большие суммы**,
- медиана и среднее значение для fraud значительно превышают соответствующие значения для non-fraud,
- различия устойчиво сохраняются при рассмотрении в логарифмической шкале.

В дальнейшем для последовательных моделей использовалось преобразование  
`amount_log = log(1 + amount)`.

---

## 5. Временной анализ (`step`)

- **Диапазон шагов:** от 1 до 743
- **Всего уникальных шагов:** 743
- **Среднее число транзакций за шаг:** 8 563
- **Максимум транзакций за шаг:** 51 352
- **Минимум транзакций за шаг:** 2

### Мошенничество во времени

- **Всего мошеннических транзакций:** 8 213
- **Шагов с мошенничеством:** 741 из 743
- **Максимум мошеннических транзакций за шаг:** 40

Мошеннические операции распределены практически по всему временному диапазону и не локализуются в одном конкретном периоде.

Анализ по часам суток (`hour_of_day`) показывает выраженный суточный ритм общего числа операций, при этом относительное распределение мошеннических транзакций по часам остаётся достаточно равномерным.

---

## 6. Корреляционный анализ

Для числовых признаков и one-hot представления типов транзакций была рассчитана матрица корреляций.

Ключевые наблюдения:
- корреляция `isFraud` с `amount`: **0.0767**
- корреляция `isFraud` с `type_TRANSFER`: **0.0539**
- корреляция `isFraud` с `type_CASH_OUT`: **0.0113**
- прочие признаки имеют близкую к нулю линейную корреляцию с целевой переменной

Следовательно, линейная зависимость выражена слабо, и для эффективного моделирования требуются нелинейные или более сложные подходы.

---

## 7. Baseline-модели

### 7.1. CatBoostClassifier (табличный baseline)

Для обучения использована подвыборка с соотношением классов **1:19**.

**Метрики качества на тестовой выборке:**

- **ROC-AUC:** 0.9700  
- **PR-AUC:** 0.7849  
- **Precision:** 0.8624  
- **Recall:** 0.5685  
- **F1-score:** 0.6853  

CatBoost показал высокую способность различать классы и служит сильной отправной точкой для дальнейших сравнений.

---

### 7.2. Attention LSTM (последовательная модель)

Транзакции сгруппированы по `nameOrig` и отсортированы по времени.  
Каждый пользователь представлен последовательностью длины 50.

#### Результаты на полном датасете (без балансировки)

- **Accuracy:** 0.9987  
- **Precision:** 0.0000  
- **Recall:** 0.0000  
- **ROC-AUC:** 0.8919  
- **F1-score:** 0.0000  

Модель фактически классифицирует все объекты как non-fraud, что является следствием сильного дисбаланса.

#### Результаты на обрезанном (сбалансированном) датасете

- **Accuracy:** 0.9607  
- **Precision:** 0.8243  
- **Recall:** 0.2723  
- **ROC-AUC:** 0.9188  
- **F1-score:** 0.4094  

Балансировка данных существенно повышает способность модели обнаруживать мошенничество, однако recall остаётся ограниченным.

---

### 7.3. Mamba-based модель (MambaClassifier)

Последовательная модель на основе Mamba-подобной архитектуры.

**Результаты на тестовой выборке:**

- **Accuracy:** 0.9506  
- **Precision:** 0.5987  
- **Recall:** 0.0369  
- **ROC-AUC:** 0.8875  
- **F1-score:** 0.0696  

Модель демонстрирует ограниченную чувствительность к мошенническому классу и уступает LSTM на сбалансированных данных.

---

## 8. Итоговые выводы

1. Датасет характеризуется экстремальным дисбалансом классов (≈0.13% fraud), что делает accuracy непоказательной метрикой.
2. Наиболее информативные признаки — тип транзакции и величина суммы.
3. Идентификаторы пользователей и получателей полезны преимущественно в последовательных и поведенческих моделях.
4. CatBoost обеспечивает высокое базовое качество и является сильным табличным baseline.
5. Последовательные модели без балансировки склонны к тривиальному решению.
6. Балансировка обучающих данных значительно повышает recall, но требует контроля ложных срабатываний.
7. Для дальнейшего повышения качества целесообразно использовать агрегатные, временные и графовые признаки, а также оптимизацию порогов классификации.

---